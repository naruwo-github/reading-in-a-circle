# CH10 必須システムサービス

## 10.1 システムクロックの設定

### システムクロックとハードウェアクロック
- ハードウェアクロック
    - ハードウェアとして内蔵された時計
    - 電源がオフでも動く（コンピュータ内の電池で動いてる）
- システムクロック
    - Linuxのカーネル内に存在する時計
    - Linux起動時にハードウェアクロックを参照して設定される→その後は独立して動く
- `date`コマンドはシステムクロックを参照して日付を表示する
    - 書式：`date [MMDDhhmm[[CC]YY][.ss]]`
        - CC: 西暦の上2桁
        - YY: 西暦の下2桁
        - ss: 秒
    - 引数を＋で始めると、表示の書式を操作できる

```
└─(11:07:46)──> date                                                                                                                                                                        ──(Sun,Feb05)─┘
Sun Feb  5 11:07:54 JST 2023
┌─(~)──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────(ubuntu@lts:pts/0)─┐
└─(11:07:54)──> date "+%Y"                                                                                                                                                                  ──(Sun,Feb05)─┘
2023
┌─(~)──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────(ubuntu@lts:pts/0)─┐
└─(11:08:06)──> date "+%Y/%m"                                                                                                                                                               ──(Sun,Feb05)─┘
2023/02
```

- `hwclock`：dateで設定したシステムクロックをハードウェアクロックに設定する
    - ハードウェアクロックを表示したり、システム→ハードに設定、ハード→システムに設定したりできる
- `timedatectl`：systemdを採用してる場合に使えるやつ

### NTPによる時刻設定
- Network Time protocol：ネットワーク経由でクロックを同期するプロトコル
- 正確な時間を設定するには、NTPサーバから情報を取得する
    - `ntpdate`：NTPサーバから現在時刻を取得する
- NTPサーバを自前で運用できる
    - 組織内にNTPクライアントが多い場合におすすめ
    - 起動例：`systemctl start ntpd.service`
    - `ntpq`：NTPサーバの状態を照会できる
    - `/etc/ntp.conf`でサーバの設定を行う

### Chrony
- NTPサーバ・クライアントソフトウェア
- デーモン`chronyd`とクライアント`chronyc`で構成される
- `/etc/chrony.conf`が設定ファイル
- ntpとchronyの両方を同時に使うことはできない

## 10.2 システムログの設定
- log: コンピュータの動作状況の記録
- syslog
    - 様々なイベントのログの入出力を管理するソフトウェア
        - 他にはrsyslog, syslog-ngなどがある
    - 他プログラムからのメッセージを受け取り、出力元や優先度に応じて分類し、指定された出力先に送る

### rsyslogの設定
- `/etc/rsyslog.conf`および/etc/rsyslog.dディレクトリ以下で行う
- 設定ファイルの書式：`ファシリティ.プライオリティ  出力先`
    - ファシリティ：メッセージの生成もと（具体的にはカーネルや実行中のプロセス）
    - プライオリティ：メッセージの重要度（低く設定するほど、ログ情報量が多くなる）
        - 「.」で指定→指定したプライオリティ以上を出力
        - 「=」で指定→指定したもののみ出力
    - 出力先：ログファイルやユーザの端末、他ホストなどを選択できる
- /etc/rsyslog.confの設定例
    - `kern.* -/var/log/kern.log`：カーネルのログを対象ファイルに出力（-は書き込みを同期しないという意味→システムクラッシュ時に保存されない可能性はある）
    - `*.*;authpriv.none /var/log/messages`：認証情報以外を全てファイルに保存する
- `logger`コマンド：
- `systemd-cat`コマンド：

## 10.3 メール管理
- 

### 
- 

## 10.4 プリンタ管理
- 

### 
- 

