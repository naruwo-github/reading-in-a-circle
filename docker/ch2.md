# Docker導入前の準備

## 検討項目の洗い出し
- そもそも自社に必要？
- ハイパーバイザー型の仮想化ソフトではライブマイグレーション機能があるが、Dockerは標準では持ち合わせていない
- DockerはHAクラスタのサポート状況がまだ不明確なので、Dockerコンテナによってプロセス監視のためのHAクラスタを構成したとしても、共有ディスクの論理ボリュームの切り替えをどのように行うか、といった課題が残っている
    - HA(High Availability)クラスタ：サーバを複数台使って冗長化し、障害が発生してもシステムの停止時間を最小限に抑るクラスターシステム
        - 例えば、業務アプリケーションが起動しているサーバーで障害が発生した場合、業務アプリケーションを他のサーバーに引き継ぐ

## Dockerを稼働させるOSの選択要件
- 導入前の検討項目
    - 既存の仮想環境における課題は何か？
        - それをDockerで解決できるのか？
    - 既存システムのどこへDocker導入するのか？
    - SLAの達成は維持できそうか？
- 導入後の検討項目
    - ホストOSはコミュニティ版にする？商用版にする？
        - どのディストリビューションにする？
    - OEMベンダーからOSとDockerの保守サポートを同時に受けれる？
        - 受けれない場合、不具合発生時の問題切り分け作業は自社で行える？
    - コンテナ専用OS使う？
        - コンテナ稼働に目的を絞ったアプライアンスサーバ
        - アプリケーションや稼働するデーモン、パッケージ管理マネージャなどが削られており、必要最低限構成
            - セキュリティ、性能、保守性が高いとされる
        - Ex. Project Atomic/RHEL Atomic Host/Snappy Ubuntu Core/CoreOS/RancherOS

## (Docker稼働における)サーバーOS vs. コンテナ専用OS
- サーバOS
    - ホストOSと同様のOS管理ができ、コンテナ内外でのOSの標準化ができる→新しい技術を学ぶ工数を削減できる
- コンテナ専用OS
    - OS環境全体の更新やロールバックなどの新しい仕組み(rpm-ostreeが有名)を理解する必要がある
    - サーバOS用のサードパーティ製アプリが動作しない可能性がある
- 考慮するべきポイント
    - OS管理の人員、スキルセットは確保している？
    - ホストOS上でサードパーティ製アプリを動かす？
    - OS管理方法は従来通りがよい？新たな手法でも問題ない？
    - DockerコンテナはGUIによる管理が必須？
    - ハードウェアベンダーやミドルウェアベンダーが提供する監視エージェント類は必要？

## Dockerのエディション
- DockerエンジンはCEとEEの二種類ある
- Docker CE
    - Docker CEにおけるストレージドライバ
        - ストレージドライバは、Dockerがイメージやコンテナを管理する際に使用するもの
            - イメージやコンテナ内のファイルシステムに加えられた変更を差分形式で保持することで、効率良くストレージを利用できるよう設計されている
            - Dockerイメージは内部的に階層構造で管理されており、コンテナからDockerイメージを作成する際は、ストレージドライバが階層構造に対して処理を施す
        - ref: https://docs.docker.com/storage/storagedriver/select-storage-driver/#supported-backing-filesystems
- Docker EE(Docker Engine - Enterprise, Docker Enterprise)
    - エンタープライズ向けのすべての機能を持つDockerサービス
    - Docker Engine - Enterprise: エンジン、オーケストレーション機能(Kubernetes, Swarm)、ネットワーキング、セキュリティ
    - Docker Enterprise: Docker Engine - Enterpriseの機能に加えて、Dockerイメージ/ユーザ/コンテナのGUI管理、Dockerイメージのセキュリティスキャンなどなど

## まとめ
- 商用版は社内システムをよく見直し、検討してから選ぼう

