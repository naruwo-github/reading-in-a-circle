# Prototype Pattern

インスタンス(prototype)から別のインスタンスを生成するパターン

- prototype: 原型、模範

## Role

| Role              | Description                                                          |
| ----------------- | -------------------------------------------------------------------- |
| Prototype         | インスタンスを複製して新たなインスタンスを作るためのメソッドを定める |
| ConcretePrototype | インスタンスを複製するメソッドを実装する                             |
| Client(Manager)   | 実際にインスタンスを複製し、インスタンス群を管理する                 |

## Sample Code

### Java

| package name | class name   | description                                                       |
| ------------ | ------------ | ----------------------------------------------------------------- |
| framework    | Product      | 抽象メソッド`use`, `createCopy`を宣言するインタフェース           |
| framework    | Manager      | `createCopy`を用いてインスタンスを複製し、管理するクラス          |
| no title     | MessageBox   | 文字列を枠線で囲って表示するクラス。`use`, `createCopy`を実装する |
| no title     | UnderlinePen | 文字列に架線を引いて表示するクラス。`use`, `createCopy`を実装する |
| no title     | Main         | ...                                                               |

### Python

※ざっくりした例

- 構成
  - `Prototype`クラス
    - `add_item`メソッド:データ追加
    - `get_data`メソッド:データ取得
    - `clone`メソッド:オブジェクトをクローン
  - `main`
    - 元のオブジェクトを変更しても、新しいオブジェクトには影響を与えないことを確認する

## Usage/Tips

- クラス名を指定せずインスタンス生成したい場合に有効
  - `new`でインスタンス生成する場合はクラス名を指定する必要がある
- 主に、下記のような場合にクラス名を指定したくないことが多い

  - 扱うオブジェクトの種類が多く、それらを別のクラスにするとファイル数が膨大になる場合
  - インスタンスが複雑な過程を経て作られるものであり、クラスから再度インスタンスを生成するのが難しい場合
    - ex. ユーザ操作で作られた図形のインスタンス
  - インスタンス生成のフレームワークを特定のクラスに依存させたくない場合

## Pros and Cons

- Pros

  - 新しいオブジェクトを生成するために必要な時間とリソースを節約できる
  - オブジェクトの生成方法を隠蔽(一箇所で管理)でき、コードをシンプルにし、かつ保守性を高められる
  - 新しいオブジェクトを生成するために必要なデータを変更することで、異なる種類のオブジェクトを簡単に生成できる

- Cons
  - クラスの継承関係が複雑になる場合がある
  - プロトタイプとなるオブジェクトが変更されると、生成されたオブジェクトに影響を与える場合がある
  - プロトタイプとなるオブジェクトに大量のデータが含まれている場合、そのデータを複製するのに時間がかかる可能性がある

## Related Patterns

- Flyweight Pattern
  - Prototype Pattern が現在のインスタンスと同じ状態の別のインスタンスを作るのに対し、Flyweight Pattern は一つのインスタンスを複数の場所で共有する
- Memento Pattern
  - スナップショットとアンドゥを行うために現在のインスタンスの状態を保存する
- Composite Pattern / Decorator Pattern
  - これらのパターンを多用すると複雑な構造のインスタンスが動的に作られる場合がある
    - このような時に Prototype Pattern が便利になる
- Command Pattern
  - Command Pattern に登場する命令を複製する場合に Prototype Pattern が使われる場合がある
