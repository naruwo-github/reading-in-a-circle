# Chain of Responsibility Pattern

- たらい回し：適切な人にたどり着くまで、次の人、次の人、に自分の要求が送られていく
- 複数のオブジェクトを鎖のように繋いでおき、そのオブジェクトの鎖を順次渡り歩いて目的のオブジェクトを決定するパターン
- 要求する側と処理する側の結びつきを弱めることができ、それぞれを部品として独立させることができる
- 状況によって、要求を処理するオブジェクトが変化するようなプログラムにも対応できる

## Role

| Role            | Description                                                                                    |
| --------------- | ---------------------------------------------------------------------------------------------- |
| Handler         | 要求を処理するインタフェースを定める                                                           |
|                 | 次の人を保持しておき、自分で処理ができない要求がきたら、次の人(これも Handler)にたらい回しする |
| ConcreteHandler | 要求を処理する具体的な役                                                                       |
| Client          | 最初の ConcreteHandler に要求を出すもの                                                        |

## Sample Code

### Java

発生したトラブルを誰かが解決しなければならない状況

| Class name     | Description                                                          |
| -------------- | -------------------------------------------------------------------- |
| Trouble        | 発生したトラブルを表す                                               |
| Support        | トラブルを解決する`抽象`クラス                                       |
| NoSupport      | トラブルを解決する`具象`クラス(トラブルを解決しない)                 |
| LimitSupport   | トラブルを解決する`具象`クラス(指定した番号未満のトラブルを解決する) |
| OddSupport     | トラブルを解決する`具象`クラス(奇数番号のトラブルを解決する)         |
| SpecialSupport | トラブルを解決する`具象`クラス(特定番号のトラブルを解決する)         |
| Main           | Support たちの連鎖を作り、トラブルを起こす                           |

## Usage/Tips/Pros and Cons

- 要求を出す人（Client)と要求を処理する人（ConcreteHandler)を緩やかに結びつけるのがポイント
  - Client は最初の人に要求を任せるだけで OK で、それ以降は Handler の方々がどうにかする
- たらい回しにより
  - 各オブジェクトが自分の仕事に集中できるようになる
  - たらい回しを使わない場合は、「A さんが処理しきれなかったら B さんに、B さんがダメなら C さんに」という「仕事の振り分け」まで個々の ConcreteHandler に任せることになってしまう
- 本パターンを使うことで、柔軟性は向上するが、処理速度が低下する
  - → 要求と処理者の関係が固定的で、処理速度が非常な重要な場合には、本パターンは適さない
- Pros
  - 要求の Handler を複数のクラスに分散できるため、システムの保守性と拡張性が向上する
  - チェーン上のどの Handler が要求を処理するかを動的に決定できるため、柔軟性がある
  - Handler はチェーン内の他の Handler の存在を意識する必要がないため、疎結合性があある
- Cons
  - Handler が不適切に設計されている場合、無限ループが発生する可能性がある
  - チェーン内の各 Handler がリクエストを完全に処理する保証がないため、結果が不確実になる可能性がある

## Related Patterns

- [Composite Pattern](../11-composite-pattern/)
  - Handler として使われることが多々ある
- [Command Pattern](../22-command-pattern/)
  - Handler に対して投げられる要求には、Command Pattern が使われる場合がある
