# Bridge Pattern

- `機能の階層`と`実装の階層`の 2 つ階層を分けつつ、それらがバラバラにならないよう繋がりを明示して橋渡しするパターン
  - 階層 ①：機能のクラス階層
    - 新しい機能を追加するために、クラス階層の中から自分の目的に近いクラスを探し、そのサブクラスを作って目的の機能を追加したクラスを産む構成のこと
  - 階層 ②：実装のクラス階層
    - 新しい実装を作るために AbstractClass のサブクラスを作って抽象メソッドを実装する、この構成のこと
  - クラス階層の混在とクラス階層の分離
    - クラス階層が一つだと、機能のクラス階層と実装のクラス階層とが一つの階層構造の中に混在することになる → クラス階層を複雑にし、見通しが悪くなってしまう
    - 2 つの独立したクラス階層に分け、バラバラにならないようそれらの間を橋渡しするのが魂胆

## Role

| Role                  | Description                                                       |
| --------------------- | ----------------------------------------------------------------- |
| `Abstraction`         | `機能のクラス階層`の最上位クラス                                  |
|                       | `Implementor`のメソッドを使って基本的な機能だけが記述されるクラス |
|                       | `Implementor`を保持する                                           |
| `RefinedAbstraction`  | `Abstraction`に対して機能を追加するもの                           |
| `Implementor`         | `実装のクラス階層`の最上位クラス                                  |
|                       | `Abstraction`のインタフェースを実装するためのメソッドを規定する   |
| `ConcreteImplementor` | `Implementor`のインタフェースを実装する                           |

## Sample Code

### Java

- 「何かを表示する」プログラム

| Bridge side        | Class name        | Description                                  |
| ------------------ | ----------------- | -------------------------------------------- |
| `機能のクラス階層` | Display           | 「表示する」クラス                           |
| `機能のクラス階層` | CountDisplay      | 「指定回数だけ表示する」機能を追加したクラス |
| `実装のクラス階層` | DisplayImpl       | 「表示する」クラス                           |
| `実装のクラス階層` | StringDisplayImpl | 「文字列を使って表示する」クラス             |
|                    | Main              | ...                                          |

### Dart

※機能と実装を階層分けできてはない。異なるクラスを橋渡しする例として記載した。

- `dart-sample/`
  - `abstraction.dart`
    - Shape, Color のインタフェースを定義
  - `bridge.dart`
    - Shape と Color を橋渡しするクラスの実装
  - `implementor.dart`
    - Shape, Color を実装
  - `main.dart`
    - 橋渡しクラスの使用

## Usage/Tips/Pros and Cons

- `機能`と`実装`をクラスレベルで階層分けしておくことで、拡張が容易になる
  - それぞれのクラス階層を独立に拡張できる
  - `機能`を追加したければ、`機能`のクラス階層に追加する
    - このとき、`実装`クラス階層は修正が不要であり、かつ追加した`機能`は**「すべての`実装`」**で利用できる
- 継承は固い結びつき、委譲はゆるやかな結びつき
  - 継承はクラスの拡張に便利だが、クラス間を強く結合させる
    - ソースコードを書き換えない限り、この関係に変化を加えられない
  - 委譲を使うと、引数で注入されたものと結びつく緩やかな結びつきとなる
    - ex. Main クラスの中で Display/CountDisplay のインスタンスに StringDisplayImpl のインスタンスを注入している。これを別の XXXDisplayImpl として注入すれば即座に変化を加えることができ、加えて変更するのは Main だけですむ。

## Related Patterns

- [Template Method Pattern](../03-template-method-pattern/)
  - `実装のクラス階層`を使うパターン
- [Abstract Factory Pattern](../08-abstract-factory-pattern/)
  - Bridge Pattern の`ConcreteImplementor`を環境に合わせて適切に構築するために用いられる場合がある
- [Adapter Pattern](../02-adapter-pattern/)
  - 機能は似ているがインタフェースは異なるクラス同士を結びつけるパターン
