# デバイスとLinuxファイルシステム
## パーティションとファイルシステムの作成
- ファイルシステム：ディスクに保存されるデータをファイルとして管理する仕組み
- ハードディスクやSSDを利用するには、ディスク内にパーティションを作り、パーティション内にファイルシステムを作り、そのファイルシステムをマウントするという作業を行う。
### ハードディスク
- 接続形態には規格がある。
    - SATA
    - SAS
    - SCSI
    - USB
- デバイスファイル：OSの入出力機能の一つで、コンピュータに接続した周辺機器などをファイルシステム上のファイルのように扱い、ファイルの読み書きと同じ手順でデータの入出力や制御をできるようにしたもの
    - 例えば、ハードディスクやSSD、DVDドライブ、シリアルポートといったデバイスの入出力を扱うための特殊なファイル
    - ファイルと同じ要領でデバイスにアクセスできる
        - デバイスへの出力＝デバイスファイルへの書き込み
        - デバイスからの入力＝デバイスファイルの読み込み
- Linuxが扱うデバイスには、ブロックデバイスとキャラクタデバイスがある
    - ブロックデバイス：ハードディスク(やパーティション)やSSDなど、メディア上の任意の場所にアクセスできるデバイスのこと
        - `lsblk`コマンド：システムのブロックデバイス一覧を表示する
    - キャラクタデバイス：キーボードやシリアルポートなど、文字単位でデータを読み書きするデバイスのこと

主なデバイスファイル
| ファイル名 | 説明 |
| --- | --- |
| /dev/sda | 1番目のハードディスク |
| /dev/sdb | 2番目のハードディスク |
| /dev/sdc | 3番目のハードディスク |
| /dev/sdd | 4番目のハードディスク |
| /dev/sr0 | 1番目のCD/DVDドライブ |
| /dev/st0 | 1番目のテープドライブ |

### パーティションの種類
- 1台のディスクドライブを複数の論理的な区画（パーティション）に分割して使うことができ、各パーティションには異なるファイルシステムを作成できる
- 基本パーティション
    - ディスク内に最大四つ作成できる
    - 内部にはファイルシステムを格納する
    - デバイスファイル名は、ハードディスク`/dev/sda`の場合、`/dev/sda1 ~ sda4`となる
- 拡張パーティション
    - 内部にはファイルシステムではなく論理パーティションを格納する
    - 基本パーティションの一つを拡張パーティションにすることができる
    - ※UEFIベースのシステムでは使われない
- 論理パーティション（拡張パーティション内に作成されたパーティションのこと）
    - デバイスファイル名は、`/dev/sda5`以降になる
    - ※UEFIベースのシステムでは使われない
- パーティション分割するメリット
    - システム障害によるファイルシステムの部分的な破壊の影響を一つのパーティション内に抑えることができる
    - 大量のログが発生してディスクの空き容量が足りなくなった場合も、被害をパーティション内に限定でき、他パーティションを使用するシステムに影響を与えなくてすむ
### ルートファイルシステム
- Linuxのディレクトリは木構造で、その頂点が`/`
- ルートファイルシステム：`/`ディレクトリを含むファイルシステム
    - 直下に`/home`や`/var`ディレクトリを配置する
        - 耐障害性や保守性を高めるために、ディスク上に複数のパーティションを用意して各パーティションに`/home`や`/var`を割り当てる
    - `/home`や`/var`は`/`以下にマウントされ、１つのファイルシステムとして運用できる
- マウント：ファイルシステム内のディレクトリツリーを、特定のディレクトリ以下に結合すること

ルートファイルシステムに必要なディレクトリ
| ディレクトリ | 内容 |
| --- | --- |
| /bin, /sbin | システムに必要なコマンド、プログラム |
| /etc | 各種設定 |
| /lib | ライブラリ |
| /dev | デバイスファイル |

### パーティション管理コマンド（※取扱注意
- `fdisk`：パーティションの作成、削除、変更、情報表示など
    - `-l`：デバイスのパーティションテーブルの状態を表示する
        - Ex. `# fdisk -l /dev/sda`
```terminal
ubuntu@lts:~$ sudo fdisk -l /dev/sda
Disk /dev/sda: 10 GiB, 10737418240 bytes, 20971520 sectors
Disk model: QEMU HARDDISK   
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 749D7C21-A688-49F2-B8BA-495B3A40591F

Device      Start      End  Sectors  Size Type
/dev/sda1  206848 20971486 20764639  9.9G Linux filesystem
/dev/sda15   2048   204800   202753   99M EFI System

Partition table entries are not in disk order.
```

- `gdisk`：GPT対応のパーティション操作をする（サブコマンドはfdiskと同じ）
    - GPT(GUIDパーティションテーブル)：パーティションテーブルの方式の一つで、最大128個までパーティションを作成できる
    - MBR(マスターブートレコード)：従来方式。扱えるハードディスク容量は2TBまでで、基本パーティションを4個作成できる
- `parted`：MBRもGPTにも対応したパーティション操作コマンド
    - fdisk, gdiskと同様に対話形式でも実行できるが、`-s`を使って一度に処理できる
- ※：fdisk, gdiskは書き込み完了後に初めてパーティションテーブルに反映されるが、partedコマンドでは即座に反映される

### ファイルシステムの作成
- ファイルを保存するには、パーティション作成後にファイルシステムを作成する必要がある
- ファイルシステム：ファイルとしてディスク上のデータを扱う仕組み
    - 「182945セクタと182946セクタのデータを取り出す」→「/dataディレクトリ下のsales.txtファイルを開く」
    - セクタ：ディスク上の区画
        - 通常、1セクタは512byteで、CD-ROMでは2048byteと媒体によってまちまち
- ファイルシステムではブロックという単位でデータを管理する
    - これにより、プログラムは、物理的な媒体の種類に関わらずブロック単位でデータを扱える（ブロックという単位が媒体の差異を吸収）
- Linuxのファイルシステムでは、①「ファイルの中身（データ）」と②「ファイルの属性や管理情報」は別々に保存されている
    - iノード(index node)：②を格納している管理領域
        - ファイルシステム作成時にあらかじめ用意されており、ファイルやディレクトリを作成するたびに１つずつ割り当てられていく
- ファイルシステムの種類
    -
- `mkfs`
    - 
- `mke2fs`
    - 

### 
- 

## ファイルシステムの管理
- 

### 
- 

## ファイルシステムのマウントとアンマウント
- 

### 
- 

## ファイルの配置と検索
- 

### 
- 

### 
- 
